<!doctype html>
<html lang="en">
  <!--
    Quizfreely
    Copyright (c) Ehan Ahamed and contributors
    Licensed under the UPL-1.0 License
    https://quizfreely.com/LICENSE.txt
  -->

  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=10, user-scalable=1"
    />
    <title>Quizfreely</title>
    <link rel="canonical" href="https://quizfreely.com" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <eta>~ data.themeCss </eta>
    <link rel="stylesheet" href="/ehui/css/ehui.min.css" />
    <link rel="stylesheet" href="/ehui/fonts/fonts.css" />
    <link
      rel="stylesheet"
      href="https://www.nerdfonts.com/assets/css/webfont.css"
    />
  </head>

  <body>
    <eta>~ include("./partials/navbar.eta") </eta>
    <div id="noscript" class="box center red">
      <p>
        You have JavaScript disabled. This website uses JavaScript to run
        correctly.
      </p>
      <p>
        Please enable JavaScript in your browser settings, or this website will
        not work.
      </p>
    </div>
    <main>
      <div class="grid page">
        <div class="content">
          <h2>Settings</h2>
          <h3>Appearance</h3>
          <div class="box">
            <p>Theme</p>
            <div id="mainAppearanceThemediv">
              <div class="radio">
                <input
                  type="radio"
                  name="theme"
                  id="mainAppearanceThemeAuto"
                  checked
                />
                <label for="mainAppearanceThemeAuto">
                  Auto
                  <span class="bg3">
                    (Purpleish or Light)
                  </span>
                </label>
              </div>
              <div class="radio">
                <input
                  type="radio"
                  name="theme"
                  id="mainAppearanceThemePurpleish"
                />
                <label for="mainAppearanceThemePurpleish">Purpleish</label>
              </div>
              <div class="radio">
                <input
                  type="radio"
                  name="theme"
                  id="mainAppearanceThemeLight"
                />
                <label for="mainAppearanceThemeLight">Light</label>
              </div>
              <div class="radio">
                <input
                  type="radio"
                  name="theme"
                  id="mainAppearanceThemeDarker"
                />
                <label for="mainAppearanceThemeDarker">Darker</label>
              </div>
            </div>
          </div>
          <h3>Account</h3>
          <div id="mainNewuserdiv" class="box">
            <p>
              You are not signed in to an account,
              <a href="./start.html">get started?</a>
            </p>
          </div>
          <div id="mainUserdiv" class="box hide">
            <p>Display name: <code id="mainUserNickname">nickname</code></p>
            <div id="mainUserEmailless" class="hide">
              <p>Username: <code id="mainUserUsername">username</code></p>
            </div>
            <div id="mainUserGoogle" class="hide">
              <p class="bg3">Signed in with Google</p>
              <p>Google account: <code id="mainUserGoogleemail">email</code></p>
            </div>
            <div class="flex">
              <a class="button" href="./setdisplayname.html"
                >Change display name</a
              >
              <a
                class="button hide"
                id="mainAccountChangepassword"
                href="./changepassword.html"
                >Change password</a
              >
            </div>
            <div class="flex">
              <button id="mainUserSignoutbutton" class="red">Sign out</button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <eta>~ include("./partials/footer.eta") </eta>
    <script>
      document.getElementById("noscript").style.display = "none";
    </script>
    <script src="https://ehui.ehan.dev/js/ehUi.js"></script>
    <script>
      function setThemeCookie(theme) {
        fetch(
          "<eta>~ data.domain </eta>/settings/theme",
          {
            method: "POST",
            body: theme
          }
        ).then(
          function (result) {
            console.log(result)
          }
        )
      }
      /* this super short script tag is for theme settings */
      document
        .getElementById("mainAppearanceThemeAuto")
        .addEventListener("change", function (event) {
          //ehUi.setTheme("auto");
          setThemeCookie("auto");
        });
      document
        .getElementById("mainAppearanceThemePurpleish")
        .addEventListener("change", function (event) {
          //ehUi.setTheme("purpleish");
          setThemeCookie("purpleish");
        });
      document
        .getElementById("mainAppearanceThemeLight")
        .addEventListener("change", function (event) {
          //ehUi.setTheme("light");
          setThemeCookie("light");
        });
      document
        .getElementById("mainAppearanceThemeDarker")
        .addEventListener("change", function (event) {
          //ehUi.setTheme("darker");
          setThemeCookie("darker");
        });

      if (localStorage.getItem("theme") === "auto") {
        document.getElementById("mainAppearanceThemeAuto").checked = true;
      } else if (localStorage.getItem("theme") === "purpleish") {
        document.getElementById("mainAppearanceThemePurpleish").checked = true;
      } else if (localStorage.getItem("theme") === "light") {
        document.getElementById("mainAppearanceThemeLight").checked = true;
      } else if (localStorage.getItem("theme") === "darker") {
        document.getElementById("mainAppearanceThemeDarker").checked = true;
      }
    </script>
    <script src="./js/states.js"></script>
    <script>
      var ui = {
        elements: {
          states: {
            newUser: ["mainNewuserdiv"],
            user: ["mainUserdiv"],
          },
        },
        states: {
          newUser: function (isNewUser) {
            if (isNewUser === false) {
              getNickname(function (nickname) {
                document.getElementById("mainUserNickname").innerText =
                  nickname;
              });
              pocketbase
                .collection("users")
                .authRefresh()
                .then(function (result) {
                  if (
                    result.data.session.user.app_metadata.provider === "email"
                  ) {
                    document
                      .getElementById("mainUserEmailless")
                      .classList.remove("hide");
                    document
                      .getElementById("mainAccountChangepassword")
                      .classList.remove("hide");
                    document
                      .getElementById("mainUserGoogle")
                      .classList.add("hide");
                    document.getElementById("mainUserUsername").innerText =
                      result.data.session.user.email
                        .replace("quizfreelyuser", "")
                        .replace("@ehan.dev", "");
                  } else if (
                    result.data.session.user.app_metadata.provider === "google"
                  ) {
                    document
                      .getElementById("mainUserEmailless")
                      .classList.add("hide");
                    document
                      .getElementById("mainAccountChangepassword")
                      .classList.add("hide");
                    document
                      .getElementById("mainUserGoogle")
                      .classList.remove("hide");
                    document.getElementById("mainUserGoogleemail").innerText =
                      result.data.session.user.email;
                  }
                });
            }
          },
        },
      };
    </script>
    <script src="./pocketbase/pocketbase.umd.js"></script>
    <script src="./js/pocketbase.js"></script>
    <script>
      document
        .getElementById("mainUserSignoutbutton")
        .addEventListener("click", function () {
          /* sign out then change signed in state without reload */
          pocketbase.authStore.clear();
          states.newUser(true);
        });
    </script>
  </body>
</html>
