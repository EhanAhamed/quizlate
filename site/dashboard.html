<!DOCTYPE html>
<html lang="en">
  <!--
  Quizfreely (quizfreely.ehan.dev)
  Copyright (c) 2022-present Ehan Ahamed and contributors
  Licensed under the UPL-1.0 License
  https://quizfreely.ehan.dev/license
  -->

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quizfreely</title>
    <link rel="canonical" href="https://quizfreely.ehan.dev" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="stylesheet" href="https://design.ehan.dev/css/colors.css" />
    <link rel="stylesheet" href="https://design.ehan.dev/css/components.css" />
    <link rel="stylesheet" href="https://design.ehan.dev/css/layouts.css" />
    <link rel="stylesheet" href="https://design.ehan.dev/css/utils.css" />
    <link rel="stylesheet" href="./fonts/fonts.css" />
    <link
      rel="stylesheet"
      href="https://www.nerdfonts.com/assets/css/webfont.css"
    />
  </head>

  <body>
    <header>
      <!--<div class="menu">
        <button id="headerMenuMenubutton">
          <i class="nf nf-md-menu"></i>
          Menu
        </button>
        <div id="headerMenuMenudiv" class="hide">
          <ul>
            <li>
              <a href="./index.html" class="bg1 mark markPrimary">Home</a>
            </li>
            <li><a href="./dashboard.html">Dashboard</a></li>
            <li><a href="./docs.html">Help & Docs</a></li>
            <li><a href="./settings.html">Settings</a></li>
          </ul>
        </div>
      </div>-->
      <div class="menu nav">
        <div>
          <a href="./index.html"> <i class="nf nf-fa-home"></i> Home</a>
        </div>
        <div class="current">
          <a href="./dashboard.html">
            <i class="nf nf-fa-edit"></i> Dashboard
          </a>
        </div>
        <div>
          <a href="./explore.html"> <i class="nf nf-fa-search"></i> Explore </a>
        </div>
        <div>
          <a href="./settings.html"> <i class="nf nf-fa-cog"></i> Settings</a>
        </div>
      </div>
      <!--<div class="options">
        <div class="flex center">
          <button id="headerOptionsLangbutton">
            <i class="nf nf-md-translate"></i>
            Language
          </button>
          <button id="headerOptionsThemebutton">
            <i class="nf nf-cod-symbol_color"></i>
            Theme
          </button>
        </div>
        <div id="headerOptionsLangdiv" class="hide">
          <div class="radio">
            <input
              type="radio"
              name="lang"
              id="headerOptionsLangdivEn"
              checked
            />
            <label for="headerOptionsLangdivEn">English</label>
          </div>
          <div class="radio">
            <input type="radio" name="lang" id="headerOptionsLangdivDe" />
            <label for="headerOptionsLangdivDe">Deutsch</label>
          </div>
          <div class="radio">
            <input type="radio" name="lang" id="headerOptionsLangdivGz" />
            <label for="headerOptionsLangdivGz">中文</label>
          </div>
        </div>
        <div id="headerOptionsThemediv" class="hide">
          <div class="radio">
            <input
              type="radio"
              name="theme"
              id="headerOptionsThemedivPurpleish"
              checked
            />
            <label for="headerOptionsThemedivPurpleish"
              >Purpleish <span class="bg3">(dark)</span></label
            >
          </div>
          <div class="radio">
            <input type="radio" name="theme" id="headerOptionsThemedivOwl" />
            <label for="headerOptionsThemedivOwl"
              >Owl <span class="bg3">(light)</span></label
            >
          </div>
        </div>
      </div>-->
    </header>
    <div id="noscript" class="box center red">
      <p>
        You have JavaScript disabled. This website uses JavaScript to run
        correctly.
      </p>
      <p>
        Please enable JavaScript in your browser settings, or this website will
        not work.
      </p>
    </div>
    <main>
      <div class="grid page">
        <div class="content">
          <!--
          Starting point ig
          -->
          <div id="mainDashboarddiv">
            <h2>Dashboard</h2>
            <p>
              Create a new study set or open a study set file you downloaded.
            </p>
            <div class="flex">
              <button id="mainDashboardCreate" onclick="buttons.load.make();">
                <i class="nf nf-oct-plus"></i>
                Create new
              </button>
              <label for="inputImportLocalFile" class="button alt">
                <i class="nf nf-md-import"></i>
                Open file
              </label>
              <input id="inputImportLocalFile" class="invisible" type="file" />
            </div>
            <div id="mainDashboardUserdiv" class="hide">
              <p>
                You are signed in. Study sets saved to your account are
                shown below.
              </p>
              <div
                id="mainDashboardUserStudysetlistdiv"
                class="grid list"
              ></div>
            </div>
          </div>

          <!--
          Action section
          -->
          <div id="mainOpendiv" class="hide">
            <div id="mainActionsSave" class="modal hide">
              <div class="content">
                <h2>Save changes?</h2>
                <div id="mainOpenActionsSaveNewuserdiv">
                  <div class="flex">
                    <a
                      id="mainOpenActionsSaveNewuserExportLocalDownload"
                      class="button alt"
                      >Download</a
                    >
                    <a href="./dashboard.html" class="button alt red"
                      >Delete Draft & Cancel</a
                    >
                  </div>
                </div>
                <div id="mainOpenActionsSaveUserdiv" class="flex">
                  <a class="button" id="mainWorkinprogressSavetoaccountbutton"
                    >Save to account</a
                  >
                  <a
                    id="mainOpenActionsSaveUserExportLocalDownload"
                    class="button alt"
                    >Download</a
                  >
                  <a href="./dashboard.html" class="button alt red"
                    >Delete Draft & Cancel</a
                  >
                </div>
                <div id="mainSaveClouderror" class="box red hide">
                  <p>
                    An unknown error prevented the study set from saving. Sorry
                    ¯\_(ツ)_/¯
                  </p>
                </div>
              </div>
            </div>
            <h2 id="mainActionsStudysettitle">Study set</h2>
            <div id="mainOpenFlashcarddiv">
              <div
                class="card double"
                id="flashcardsCard"
                onclick="buttons.flashcards.flip()"
              >
                <div class="content" id="flashcardsContent">
                  <div class="front" id="flashcardsFront">front</div>
                  <div class="back" id="flashcardsBack">back</div>
                </div>
              </div>
              <div class="caption">
                <p id="mainActionsFlashcardoptionsIndex">1/1</p>
                <div class="flex justifyselfcenter">
                  <button
                    id="flashcardsPrev"
                    onclick="buttons.flashcards.prev()"
                  >
                    <i class="nf nf-cod-arrow_left"></i>
                  </button>
                  <button onclick="buttons.flashcards.flip()">Flip</button>
                  <button
                    id="flashcardsNext"
                    onclick="buttons.flashcards.next()"
                  >
                    <i class="nf nf-cod-arrow_right"></i>
                  </button>
                </div>
              </div>
            </div>
            <p id="mainOpenSavedone" class="bg3 hide">
              <i class="nf nf-oct-check"></i>
              Saved to account
            </p>
            <!-- Add "this study set is private/public..." thingy here too -->
            <div class="flex">
              <button onclick="buttons.open.edit();">Edit</button>
              <button
                onclick="exportLocal.save();ui.elements.open.save.classList.remove('hide');"
              >
                Save a copy or download
              </button>
            </div>
            <table class="outer" id="mainActionsTable">
              <!--
                IMPORTANT:
                the html below is also used in buttons.js, (its copied into a string)
                if this html is updated, change it there too
              -->
              <thead>
                <tr>
                  <th>Term</th>
                  <th>Definition</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <button onclick="buttons.open.edit();">Edit</button>
                  </td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div id="mainEditdiv" class="hide">
            <div id="mainEditStudySetIsCopy" class="modal hide">
              <div class="content">
                <h2>¯\_(ツ)_/¯</h2>
                <p>
                  A study set with this name already exists in your account.
                  <br />
                  You can update/overwrite the existing copy or go back and
                  rename this copy.
                </p>
                <div class="flex">
                  <button id="mainEditStudySetIsCopyUpdate">
                    Update existing
                  </button>
                  <button id="mainEditStudySetIsCopyBack">Go back</button>
                </div>
              </div>
            </div>
            <h2>Edit</h2>
            <input id="mainEditName" type="text" placeholder="Title" />
            <table class="outer" id="mainEditTable">
              <!--
                IMPORTANT:
                the html below is also used in buttons.js, (its copied into a string)
                if this html is updated, change it there too
              -->
              <thead>
                <tr>
                  <th class="center">Term</th>
                  <th class="center">Definition</th>
                  <th class="center">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="flex">
                      <button onclick="buttons.edit.add();">
                        <i class="nf nf-oct-plus"></i>
                        Add row
                      </button>
                    </div>
                  </td>
                  <td></td>
                  <td></td>
                </tr>
              </tbody>
            </table>
            <div id="mainEditSettingsPublic">
              <div class="radio">
                <input
                  type="radio"
                  name="public"
                  id="publicFalse"
                  checked="true"
                />
                <label for="publicFalse"
                  >Private
                  <span class="bg3"
                    >(Visible to you and anyone you give the downloadable file
                    to)</span
                  ></label
                >
              </div>
              <div class="radio">
                <input type="radio" name="public" id="publicTrue" />
                <label for="publicTrue"
                  >Public
                  <span class="bg3"
                    >(Visible to everyone, can only be edited by you)</span
                  ></label
                >
              </div>
            </div>
            <button id="buttonEditDone" onclick="buttons.edit.done()">
              <i class="nf nf-oct-check"></i>
              Done
            </button>
          </div>
        </div>
      </div>
    </main>
    <!--
    Footer, copyright, & license
    -->
    <footer>
      <h2>Quizfreely</h2>
      <p>
        Copyright © 2022-present Ehan Ahamed and contributors <br />
        Licensed under the UPL-1.0 License
      </p>
      <a href="./license.html">See License</a>
      <br />
      <a href="./privacypolicy.html">See Privacy Policy</a>
    </footer>
    <script>
      document.getElementById("noscript").style.display = "none";
    </script>
    <script>
      function loadDashboard() {
        supabaseClient.auth.getUser().then(function (result) {
          userId = result.data.user.id;
        });
        supabaseClient
          .from("studyset")
          .select()
          .then(function (result) {
            studysetlist = result.data;
            if (studysetlist.length === 0) {
              var box = document.createElement("div");
              box.setAttribute("class", "box");
              box.setAttribute("id", "mainDashboardUserStudysetlistEmpty");
              document
                .getElementById("mainDashboardUserStudysetlistdiv")
                .appendChild(box);
              document.getElementById(
                "mainDashboardUserStudysetlistEmpty"
              ).innerHTML = "<p>No study sets are saved to your account.</p>";
            } else {
              for (var i = 0; i < studysetlist.length; i++) {
                var box = document.createElement("div");
                box.setAttribute("class", "box");
                box.setAttribute(
                  "id",
                  "mainDashboardUserStudysetlist" + i.toString()
                );
                document
                  .getElementById("mainDashboardUserStudysetlistdiv")
                  .appendChild(box);
                document.getElementById(
                  "mainDashboardUserStudysetlist" + i.toString()
                ).innerHTML =
                  "<p>" +
                  studysetlist[i].name +
                  "</p> <div class='flex'> <button id='mainDashboardUserStudysetlist" +
                  i.toString() +
                  "Openbutton'> Open </button> <button id='mainDashboardUserStudysetlist" +
                  i.toString() +
                  "Deletebutton' class='red alt'> Delete </button>";
                document
                  .getElementById(
                    "mainDashboardUserStudysetlist" +
                      i.toString() +
                      "Openbutton"
                  )
                  .addEventListener("click", function (event) {
                    sessionData.studySetData =
                      /* studysetlist.ID.json */
                      /* to get the selected ID, take event.target.id and remove the extra text like "mainDashboard..." and "Openbutton..." */
                      studysetlist[
                        event.target.id
                          .replace("mainDashboardUserStudysetlist", "")
                          .replace("Openbutton", "")
                      ].json;
                    studySet.open();
                    document
                      .getElementById("mainActionsSave")
                      .classList.add("hide");
                  });
                document
                  .getElementById(
                    "mainDashboardUserStudysetlist" +
                      i.toString() +
                      "Deletebutton"
                  )
                  .addEventListener("click", function (event) {
                    var thisId = studysetlist[
                        event.target.id
                          .replace("mainDashboardUserStudysetlist", "")
                          .replace("Deletebutton", "")
                      ].id
                    supabaseClient
                      .from("studyset")
                      .delete()
                      .eq("id", thisId)
                      .then(function (result) {
                        console.log("ran delete() to studyset table with result:")
                        console.log(result);
                      });
                    supabaseClient
                      .from("studyset")
                      .select()
                      .eq("id", thisId)
                      .then(
                        function (result) {
                          var thisName = result.data[0].name;
                          supabaseClient
                            .from("explore")
                            .delete()
                            .eq("user_id", userId)
                            .eq("name", thisName)
                            .then(
                              function (result) {
                                location.reload();
                              }
                            )
                        }
                      )
                  });
              }
            }
          });
        document
          .getElementById("mainWorkinprogressSavetoaccountbutton")
          .addEventListener("click", function () {
            supabaseClient
              .from("studyset")
              .insert({
                user_id: userId,
                name: sessionData.studySetData.name,
                json: sessionData.studySetData,
              })
              .then(function (result) {
                if (result.status === 201) {
                  ui.elements.open.saveDone.classList.remove("hide");
                  ui.elements.open.save.classList.add("hide");
                  document
                    .getElementById("mainSaveClouderror")
                    .classList.add("hide");
                } else if (result.status !== 201) {
                  ui.elements.open.saveDone.classList.add("hide");
                  document
                    .getElementById("mainSaveClouderror")
                    .classList.remove("hide");
                }
              });
              if (sessionData.studySetData.settings.public === true) {
                supabaseClient
                .from("explore")
                .insert({
                  user_id: userId,
                  name: sessionData.studySetData.name,
                  json: sessionData.studySetData,
                })
                .then(function (result) {
                  console.log(
                    "ran insert() to explore table on " + sessionData.studySetData.name + " with result:"
                  );
                  console.log(result);
                });
              } else {
                /* if its not public in settings, but the set is in explore from a previous save, delete it from explore */
                supabaseClient
                  .from("explore")
                  .delete()
                  .eq("user_id", userId)
                  .eq("name", sessionData.studySetData.name)
                  .then(function (result) {
                    console.log(
                      "study set settings changed to private so, ran delete() to explore table on " + sessionData.studySetData.name + " with result:"
                    );
                    console.log(result);
                  });
              }
          });
      }
    </script>
    <script src="./js/states.js"></script>
    <script>
      var ui = {
        elements: {
          sections: {
            dashboard: document.getElementById("mainDashboarddiv"),
            open: document.getElementById("mainOpendiv"),
            edit: document.getElementById("mainEditdiv"),
            /* flashcards: document.getElementById("sectionFlashcards"), */
          },
          buttons: {
            create: document.getElementById("mainDashboardCreate"),
            importOptions: document.getElementById("buttonImportOptions"),
          },
          inputs: {
            importLocal: {
              file: document.getElementById("inputImportLocalFile"),
            },
            edit: {
              name: document.getElementById("mainEditName"),
              table: document.getElementById("mainEditTable"),
            },
          },
          links: {
            exportLocal: {
              newUserDownload: document.getElementById(
                "mainOpenActionsSaveNewuserExportLocalDownload"
              ),
              userDownload: document.getElementById(
                "mainOpenActionsSaveUserExportLocalDownload"
              ),
            },
          },
          alerts: {
            successImport: document.getElementById("alertSuccessImport"),
            errorImport: document.getElementById("alertErrorImport"),
            flashcardsEnd: document.getElementById("alertFlashcardsEnd"),
          },
          open: {
            save: document.getElementById("mainActionsSave"),
            saveDone: document.getElementById("mainOpenSavedone"),
          },
          edit: {
            table: document.getElementById("mainEditTable"),
            settings: {
              public: {
                true: document.getElementById("publicTrue"),
                false: document.getElementById("publicFalse")
              }
            },
            studySetIsCopy: document.getElementById("mainEditStudySetIsCopy"),
            studySetIsCopyButtons: {
              update: document.getElementById("mainEditStudySetIsCopyUpdate"),
              back: document.getElementById("mainEditStudySetIsCopyBack"),
            },
          },
          flashcards: {
            card: document.getElementById("flashcardsCard"),
            content: document.getElementById("flashcardsContent"),
            front: document.getElementById("flashcardsFront"),
            back: document.getElementById("flashcardsBack"),
          },
          states: {
            newUser: [document.getElementById("mainOpenActionsSaveNewuserdiv")],
            user: [
              document.getElementById("mainDashboardUserdiv"),
              document.getElementById("mainOpenActionsSaveUserdiv"),
              document.getElementById("mainEditSettingsPublic")
            ],
          },
        },
        states: {
          newUser: function (isNewUser) {
            if (isNewUser === false) {
              loadDashboard();
            }
          },
        },
      };
    </script>
    <script src="https://design.ehan.dev/js/themes.js"></script>
    <script src="./js/sections.js"></script>
    <script src="./js/buttons.js"></script>
    <script src="./js/studySet.js"></script>
    <script src="./js/sessionData.js"></script>
    <script src="./js/importLocal.js"></script>
    <script src="./js/edit.js"></script>
    <script src="./js/exportLocal.js"></script>
    <script src="./js/flashcards.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.29.0"></script>
    <script src="./js/supabase.js"></script>
    <script>
      /* functionality of studySetIsCopy buttons below */
      ui.elements.edit.studySetIsCopyButtons.update.addEventListener(
        "click",
        function () {
          /* code here is also (1) */
          /* updateStudySet() & isStudySetCopy() are in js/supabase.js */
          updateStudySet();
          studySet.open();
          ui.elements.edit.studySetIsCopy.classList.add("hide");
        }
      );
      ui.elements.edit.studySetIsCopyButtons.back.addEventListener(
        "click",
        function () {
          ui.elements.edit.studySetIsCopy.classList.add("hide");
        }
      );
      /*
      Make download button also hide the modal when clicked (just like save to acc button)
      */
      ui.elements.links.exportLocal.newUserDownload.addEventListener(
        "click",
        function () {
          ui.elements.open.save.classList.add("hide");
        }
      );
      ui.elements.links.exportLocal.userDownload.addEventListener(
        "click",
        function () {
          ui.elements.open.save.classList.add("hide");
        }
      );
    </script>
  </body>
</html>
